# /etc/systemd/system/zoo_tracker.service.d/hardening.conf
[Service]
# Don’t gain privileges, don’t use set*id, keep tmp/dev private, lock kernel knobs
NoNewPrivileges=yes
RestrictSUIDSGID=yes
PrivateTmp=yes
PrivateDevices=yes
ProtectKernelTunables=yes
ProtectKernelModules=yes
ProtectKernelLogs=yes
ProtectControlGroups=yes
ProtectClock=yes
ProtectHostname=yes
LockPersonality=yes
RestrictRealtime=yes
SystemCallArchitectures=native
MemoryDenyWriteExecute=yes
UMask=0077

# Make the whole system read-only except for paths we explicitly allow
ProtectSystem=strict
ProtectHome=read-only
ReadOnlyPaths=/opt/zoo_tracker_server
# Writable runtime dir (e.g., for sockets/PIDs if you ever need them)
RuntimeDirectory=zoo-tracker
RuntimeDirectoryMode=0750
ReadWritePaths=/run/zoo-tracker

# Capabilities: none (we don’t bind <1024 or reconfigure networking)
AmbientCapabilities=
CapabilityBoundingSet=

# Networking: only UNIX + loopback (Nginx and local Postgres)
RestrictAddressFamilies=AF_UNIX AF_INET AF_INET6
IPAddressDeny=any
IPAddressAllow=127.0.0.1
IPAddressAllow=::1

# Seccomp: start from @system-service and deny high-risk classes
SystemCallFilter=@system-service
SystemCallFilter=~@privileged @resources @mount @module @raw-io @reboot @swap @obsolete @cpu-emulation
SystemCallErrorNumber=EPERM

# Avoid writing .pyc next to your code (keeps /opt read-only happy)
Environment=PYTHONDONTWRITEBYTECODE=1

